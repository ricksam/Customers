select 
  cnpj,
  fantasia as empresa,
  dtemissao as emissao,
  min(idvdapdv) as menor, 
  max(idvdapdv) as maior, 
  count(idvdapdv) as contagem,
  max(idvdapdv) - (min(idvdapdv)-1) as diferenca
from vdapdv , empresa
where 
  dtemissao >= getdate()-5 and
  dtemissao <= getdate() 
group by 
  cnpj,
  fantasia,
  dtemissao